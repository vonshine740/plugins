/**
 * by wanghsuai
 * 9.10自动浮动元素 滚定向上移
 */
;(function($){var smartFixObj=function(itemElem){var self=this;this.elem=itemElem;this.initH=this.elem.siblings('.smartFix-fixOffsetCon').length>0?parseInt(this.elem.siblings('.smartFix-fixOffsetCon').offset().top,10):parseInt((this.elem).offset().top,10);this.initSelfH=parseInt(this.elem.outerHeight(),10);this.initW=parseInt(this.elem.outerWidth(),10);this.scrollFlag=false;this.footer=$('.smartFixElemFooter');this.mgt=parseInt(this.elem.css('margin-top'),10);this.setting={"offsetTopVal":0,"zIndexVal":1}$.extend(this.setting,this.getSetting());$(document).scroll(function(){var scrolls=document.documentElement.scrollTop||document.body.scrollTop;self.judgeFixed(scrolls);self.scrollFlag=self.judgeVisible(scrolls)});window.onload=function(){self.fixOnloadBugs()}};smartFixObj.prototype={getSetting:function(){var setting=this.elem.attr('data-setting');if(setting&&setting!=''){return $.parseJSON(setting)}else{return{}}},judgeFixed:function(offsetT){var footerH=this.footer?this.footer.outerHeight():0;var footerOffsetT=this.footer?this.footer.offset().top:0;if(offsetT>this.initH-this.mgt){if((offsetT+$(window).height()-footerOffsetT)+this.initSelfH+parseInt(this.setting.offsetTopVal,10)>=$(window).height()){this.scrollByPage($(window).height()-(offsetT+$(window).height()-footerOffsetT)-this.initSelfH-50)}else{this.fixOffset();this.fixElement()}}else if(this.elem.siblings('.smartFix-fixOffsetCon').length>0){this.fixOffset("remove");this.fixElement("remove")}},fixOffset:function(action){if(!this.scrollFlag){return}if(this.elem.siblings('.smartFix-fixOffsetCon').length>0){if(action=="remove"){this.elem.siblings('.smartFix-fixOffsetCon').remove()}}else{$('<div class="smartFix-fixOffsetCon"></div>').insertBefore(this.elem).css({'height':this.initSelfH})}},fixElement:function(action){if(!this.scrollFlag){return}if(action=="remove"){this.elem.css({"position":"static"})}else{this.elem.css({'position':'fixed','z-index':this.setting.zIndexVal,'top':this.setting.offsetTopVal-this.mgt,"width":this.initW})}},judgeVisible:function(offsetT){if(this.initH-offsetT<=$(window).height()){return true}else{return false}},scrollByPage:function(topVal){this.elem.css({"position":"fixed","top":topVal,"width":this.initW})},fixOnloadBugs:function(){var scrolls=document.documentElement.scrollTop||document.body.scrollTop;if(scrolls!=0){this.judgeFixed(scrolls);this.elem.css('position','static')}}};smartFixObj.init=function(){var smartFixEles=$('.smartFixElem'),_this_=this;smartFixEles.each(function(){new _this_($(this))})};window.smartFixObj=smartFixObj})(jQuery);$(function(){var initSmartFix=(function(){var smartFixObjItems=$('.smartFixElem'),smartFixObjLen=smartFixObjItems.length,smartFixObjNewLen=0;if(smartFixObjLen>0){smartFixObj.init()}$(document).ajaxComplete(function(){smartFixObjNewLen=$('.smartFixElem').length;if(smartFixObjLen!=smartFixObjNewLen){smartFixObj.init()}})})()});